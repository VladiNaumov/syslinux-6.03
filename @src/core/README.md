### - BIOS-загрузка:
Когда BIOS запускает загрузку с устройства (например, флешки или жесткого диска), он загружает загрузочный сектор (MBR или VBR).
В этом секторе находится код, который указывает BIOS загрузить файл ldlinux.sys. Этот файл является основным бинарным компонентом загрузчика Syslinux. 
ldlinux.sys уже загружает ядро операционной системы или другой загрузочный компонент.

### - UEFI-загрузка:
В UEFI-режиме загрузочным файлом обычно является syslinux.efi (в некоторых версиях также может называться иначе). Этот файл запускается UEFI вместо BIOS и выполняет ту же роль, что и ldlinux.sys в BIOS-режиме.
Таким образом, ldlinux.sys (для BIOS) или syslinux.efi (для UEFI) являются ключевыми файлами для запуска процесса загрузки через Syslinux.

### Основные папки и файлы: 

- mbr/mbr.S - исходник для загрузочного сектора MBR.

- core/ - содержит исходный код основного ядра Syslinux.
	- isolinux.asm - исходный файл для ISOLINUX (загрузчик для CD/DVD).
	- ldlinux.asm - основной файл, отвечающий за BIOS-загрузку с дисков или USB.
	- syslinux.asm - код, связанный с основной частью загрузчика.
	- pxelinux.asm - это исходный файл, отвечающий за работу PXELINUX (содержит код для начального этапа загрузки в сетевой среде)

- efi/ - содержит файлы для UEFI-загрузки.
	- syslinux.efi.c - исходный код UEFI-загрузчика.

- com32/ - модульная структура для дополнительных утилит и функций.
	- menu.c32 - меню загрузки.
	- libcom32.c - библиотека для работы с COM32-модулями (расширяемость Syslinux).


### Основные файлы Syslinux, ответственные за загрузку ядра:

1. **`core/isolinux.asm`** (или другие варианты для MBR, PXE и т.д.) — это ассемблерный код, отвечающий за начальную загрузку. Именно этот код будет вызван BIOS и начинает работу по загрузке ядра. Этот код считывает секторы с диска и загружает основную часть загрузчика.
   
2. **`core/fs`** (например, `core/fs/iso9660_fs.c`, `core/fs/fs.c`) — содержит код для работы с файловыми системами, такими как ISO 9660, FAT и др. Эти модули позволяют загрузчику находить ядро ОС на диске.

3. **`com32/elflink/ldlinux/ldlinux.c`** — основной компонент, который отвечает за загрузку и передачу управления ядру. После того как начальная загрузочная программа из **`core/`** загружает и инициализирует более сложные модули, этот код отвечает за нахождение ядра ОС, загрузку его в память и передачу ему управления.

4. **`com32/lib/sys/module.c`** — здесь реализованы основные функции для загрузки ELF-модулей, включая ядро Linux. Этот файл управляет процессом загрузки ядра и перемещает его в нужные области памяти.

### Процесс загрузки ядра:

1. **Загрузчик на ассемблере** — Начальный загрузчик (например, `isolinux.asm` или `syslinux.asm`) работает в режиме реального времени (16-битный режим) и считывает начальные секторы с диска. Загрузчик загружает сам себя в память, а затем считывает следующие блоки, необходимые для работы.

2. **Переход в 32-битный защищённый режим** — Когда загрузчик завершает начальную фазу загрузки, он переключается в защищённый режим (32-битный). Это делается для того, чтобы начать более сложные операции, такие как работа с файловыми системами и загрузка ядра.

3. **Поиск и загрузка ядра** — Файлы, такие как `ldlinux.c`, отвечают за то, чтобы найти ядро ОС (например, `vmlinuz`) на файловой системе, загрузить его в память и инициализировать.

4. **Передача управления ядру** — После того как ядро загружено в память, загрузчик передает ему управление. Это делается через вызов функций, реализованных в файлах на C, таких как `ldlinux.c`. Управление передается через переход на указатель на начало ядра в памяти.

### Основные функции
- **`syslinux_boot_linux()`** — функция, которая загружает ядро Linux в память.
- **`module_load()`** — функция, которая загружает ELF-модули (включая ядро).
- **`jump_to_kernel()`** — эта функция вызывает ядро и передает ему управление.


1. **Основной загрузчик (`mbr/mbr.S` и `isolinux.asm`):**
   - Рассмотрение кода, отвечающего за начальную загрузку и инициализацию системы.
   - Анализ функций и процедур, которые выполняются на этом этапе.
   - Изучение, как выбирается файловая система и как происходит передача управления следующему этапу загрузки.

2. **Загрузчик на основе BIOS (`syslinux.asm`, `ldlinux.asm`):**
   - Изучение кода, который управляет загрузкой с носителя.
   - Анализ функций для работы с файловыми системами, таких как чтение и проверка данных на носителе.
   - Рассмотрение механизмов для загрузки конфигурационных файлов и ядра.

3. **Файловая система (`fs/fat.c`, `fs/iso9660.c`):**
   - Понимание, как загрузчик взаимодействует с файловыми системами для доступа к данным.
   - Изучение способов чтения конфигурационных файлов и образа ядра.
   - Анализ процесса поиска и загрузки ядра.

4. **Загрузка ядра:**
   - Рассмотрение кода, который загружает ядро в память.
   - Анализ того, как управление передается ядру и какие шаги выполняются для его подготовки к запуску.


### Вот этапы загрузки ОС:

1. **Первичный загрузчик (MBR)**: BIOS загружает и выполняет код MBR (Master Boot Record), который находится в первом секторе диска. Этот код отвечает за начальную инициализацию и поиск загрузчика.
	- Для SYSLINUX это `mbr/mbr.S`. 
	- Этот файл инициализирует аппаратное обеспечение и находит вторичный загрузчик.

2. **Вторичный загрузчик**: MBR загружает и выполняет вторичный загрузчик, такой как GRUB или SYSLINUX, который находится в заданной области диска (например, в разделах или в специальном файле).
	- Для SYSLINUX это `isolinux.asm` или `ldlinux.asm`.
	- Он предоставляет среду для загрузки и подготовки системного ядра, управляя его загрузкой и передачей управления.

3. **Загрузчик ОС**: Вторичный загрузчик (например, ISOLINUX/LDLINUX для SYSLINUX) загружает и запускает ядро ОС, обеспечивая передачу управления инициализации ядра.
	- Код загрузчика ОС может включать файлы, такие как `syslinux.asm` или модули в директории `com32/`, например `menu.c32` и `libcom32.c`.
	- После загрузки ядра, этот загрузчик может выполнять дополнительные задачи по подготовке системы перед запуском ядра.
	
4. **Инициализация ядра**: Ядро ОС загружается в память, выполняет начальную инициализацию аппаратного обеспечения и файловой системы.
	- Исходный код ядра Linux, например, `kernel/main.c` и другие файлы из директории ядра.
	- Ядро, загруженное загрузчиком ОС, выполняет начальную инициализацию системы и готовит её к запуску пользовательских процессов.

5. **Запуск системных процессов**: Ядро передает управление процессу init (или системному менеджеру), который запускает все остальные системные процессы и службы, обеспечивая полный запуск ОС.
	- Это может быть файл, связанный с инициализацией системы, такой как `init` в исходном коде ядра или файл из пакета системных утилит, в зависимости от дистрибутива ОС.
	- Этот этап начинается с выполнения инициализационного процесса (например, init), который запускает все остальные системные службы и процессы, обеспечивая функционирование ОС.
	
 ** эти файлы взаимосвязаны и работают вместе в процессе загрузки: **
 
 
 ###  Вот как соотносятся файлы MBR.s, ldlinux.asm и syslinux.c в контексте процесса загрузки:

 mbr.s (Master Boot Record)

- Роль: Первичный загрузчик (или MBR) загружается первым, когда компьютер запускается. Этот код выполняется непосредственно от BIOS и отвечает за начальную загрузку и передачу управления вторичному загрузчику.
- Задачи: 
	- Инициализация начальных условий. 
	- Поиск и передача управления вторичному загрузчику (например, ldlinux.asm).

 ldlinux.asm (вторичный загрузчик)
- Роль: Вторичный загрузчик загружается после MBR. Он отвечает за более сложные операции, такие как монтирование файловых систем и подготовка среды для загрузки основной части загрузчика.
- Задачи:
	- Инициализация и настройка среды. 
	- Поиск и загрузка дополнительных файлов (например, syslinux.c).
	- Передача управления основному загрузчику или операционной системе.

 syslinux.c (основной загрузчик)
- Роль: Это основной компонент загрузчика SYSLINUX, написанный на C. Он выполняет задачи по подготовке системы для загрузки ядра, конфигурации и управлению загрузочным процессом.
- Задачи: 
	- Монтирование файловых систем и работа с ними.
	- Чтение конфигурационных файлов и загрузка ядра или других необходимых файлов.
	- Запись информации на диск и настройка среды для загрузки.
	- Передача управления загруженному ядру или другому компоненту системы.

### Процесс загрузки:

mbr.s:
- Выполняется первым при старте системы.
- Находит и загружает вторичный загрузчик, например, ldlinux.asm.

ldlinux.asm:
- Загружается после MBR и выполняет более сложные операции.
- Монтирует файловые системы и готовит окружение для загрузки.

syslinux.c:
- Запускается после ldlinux.asm.
- Выполняет окончательную подготовку, такую как чтение конфигурации и загрузка ядра.

Таким образом, каждый из этих файлов играет свою роль в процессе загрузки и выполняет специфические задачи, необходимые для успешной загрузки системы.


### После того как загрузчик syslinux.c завершает свою работу, происходит следующий этап загрузки:

1. Завершение работы загрузчика SYSLINUX
- Подготовка к загрузке ядра: syslinux.c завершает настройку системы, может выполнять операции, такие как запись на диск, изменение конфигураций и т.д. Обычно на этом этапе он загружает и подготавливает ядро Linux и необходимые параметры для его запуска.
- Передача управления ядру: Загрузчик SYSLINUX передает управление загруженному ядру Linux. Это может происходить через команду передачи управления, где адрес ядра и его параметры указываются в регистре процессора.

2. Загрузка ядра Linux
- Декларирование и инициализация ядра: Как только управление передано ядру, оно начинает свою работу. Ядро инициализирует свою среду, включая загрузку модулей, настройку оборудования и проверку файловых систем.
- Декларация начального файла системы: Ядро Linux может загружать и монтировать корневую файловую систему, а также проверять и настраивать доступ к другим необходимым ресурсам.
- Запуск инициализационного процесса: После успешной загрузки ядра и начальной настройки система переходит к запуску пользовательского процесса инициализации, обычно init (или системные альтернативы, такие как systemd).

3. Инициализация системы
- Запуск init: После того как ядро завершило свою инициализацию, оно запускает процесс инициализации системы (init), который отвечает за дальнейшее управление и запуск системных служб и приложений.
- Загрузка пользовательских процессов: Процесс init (или его альтернативы) начинает загрузку системных служб, приложений и запускает пользовательские сеансы.
